#!/bin/bash
# ClaudeCodeè‡ªå‹•æ‰¿èªã‚·ã‚¹ãƒ†ãƒ  ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
# æ‰‹å‹•æ‰¿èªã‚’å¤§å¹…å‰Šæ¸›ã—ã¦é–‹ç™ºåŠ¹çŽ‡ã‚’å‘ä¸Š

echo "ðŸ¤– ClaudeCodeè‡ªå‹•æ‰¿èªã‚·ã‚¹ãƒ†ãƒ  ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—"
echo "============================================"

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆç¢ºèª
PROJECT_ROOT="/Users/suetakeshuuhei/MIRRALISM_V2"
cd "$PROJECT_ROOT" || {
    echo "âŒ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $PROJECT_ROOT"
    exit 1
}

echo "ðŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆ: $PROJECT_ROOT"

# å¿…è¦ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
echo "ðŸ“‚ å¿…è¦ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆä¸­..."
mkdir -p .mirralism/logs
mkdir -p .mirralism/config
mkdir -p .mirralism/stats

# è‡ªå‹•æ‰¿èªã‚·ã‚¹ãƒ†ãƒ ã‚’æœ‰åŠ¹åŒ–
echo "ðŸ”„ è‡ªå‹•æ‰¿èªã‚·ã‚¹ãƒ†ãƒ ã‚’æœ‰åŠ¹åŒ–ä¸­..."
python3 scripts/claude_auto_approver.py --enable

# ç’°å¢ƒå¤‰æ•°è¨­å®š
echo "ðŸŒ ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šä¸­..."
source .mirralism/claude_env.sh

# è¨­å®šç¢ºèª
echo "ðŸ“Š è¨­å®šçŠ¶æ³ã‚’ç¢ºèªä¸­..."
python3 scripts/claude_auto_approver.py --status

# CLAUDE.mdã«è¨­å®šè¿½åŠ 
echo "ðŸ“ CLAUDE.mdã«è‡ªå‹•æ‰¿èªè¨­å®šã‚’è¿½åŠ ä¸­..."

# CLAUDE.mdã®è‡ªå‹•æ‰¿èªã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
if ! grep -q "# ClaudeCodeè‡ªå‹•æ‰¿èª" CLAUDE.md; then
    cat >> CLAUDE.md << 'EOF'

# ClaudeCodeè‡ªå‹•æ‰¿èªè¨­å®š

## ðŸ¤– è‡ªå‹•æ‰¿èªã‚·ã‚¹ãƒ†ãƒ 

ClaudeCodeã®æ‰‹å‹•æ‰¿èªã‚’å¤§å¹…å‰Šæ¸›ã™ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®æ“ä½œã¯è‡ªå‹•æ‰¿èªã•ã‚Œã¾ã™ï¼š

### âœ… è‡ªå‹•æ‰¿èªå¯¾è±¡
- **ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ**: èª­ã¿è¾¼ã¿ã€ç·¨é›†ã€ä½œæˆã€ç§»å‹•
- **ã‚³ãƒ¼ãƒ‰æ“ä½œ**: ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆã€ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã€ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ 
- **Gitæ“ä½œ**: add, commit, status, diff, log
- **ãƒ“ãƒ«ãƒ‰æ“ä½œ**: ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã€ãƒªãƒ³ãƒˆã€ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: READMEæ›´æ–°ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ

### âš ï¸ æ‰‹å‹•ç¢ºèªãŒå¿…è¦
- ã‚·ã‚¹ãƒ†ãƒ è¨­å®šå¤‰æ›´
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œ
- æœ¬ç•ªç’°å¢ƒé–¢é€£
- ä¸€æ‹¬ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šå¤‰æ›´

### ðŸ”§ è¨­å®šå¤‰æ›´
```bash
# è‡ªå‹•æ‰¿èªã‚’æœ‰åŠ¹åŒ–
python3 scripts/claude_auto_approver.py --enable

# è‡ªå‹•æ‰¿èªã‚’ç„¡åŠ¹åŒ–  
python3 scripts/claude_auto_approver.py --disable

# çŠ¶æ³ç¢ºèª
python3 scripts/claude_auto_approver.py --status
```

### ðŸ“Š ä½¿ç”¨çµ±è¨ˆ
è‡ªå‹•æ‰¿èªã®ä½¿ç”¨çµ±è¨ˆã¯ `.mirralism/claude_auto_approval.json` ã§ç¢ºèªã§ãã¾ã™ã€‚

EOF
    echo "âœ… CLAUDE.mdã«è‡ªå‹•æ‰¿èªè¨­å®šã‚’è¿½åŠ ã—ã¾ã—ãŸ"
else
    echo "â„¹ï¸ CLAUDE.mdã«è‡ªå‹•æ‰¿èªè¨­å®šã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™"
fi

# å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
echo ""
echo "ðŸŽ‰ ClaudeCodeè‡ªå‹•æ‰¿èªã‚·ã‚¹ãƒ†ãƒ ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸï¼"
echo ""
echo "ðŸ“‹ è¨­å®šå†…å®¹:"
echo "   âœ… è‡ªå‹•æ‰¿èª: æœ‰åŠ¹"
echo "   âœ… ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ: è‡ªå‹•"
echo "   âœ… Gitæ“ä½œ: è‡ªå‹•"
echo "   âœ… ã‚³ãƒ¼ãƒ‰å“è³ª: è‡ªå‹•"
echo "   âš ï¸ é«˜ãƒªã‚¹ã‚¯æ“ä½œ: æ‰‹å‹•ç¢ºèª"
echo ""
echo "ðŸš€ ã“ã‚Œã§ ClaudeCode ã§ã®ä½œæ¥­ãŒãšã£ã¨æ¥½ã«ãªã‚Šã¾ã™ï¼"
echo "   æ¯Žå›žã€ŒYesã€ã¨ç­”ãˆã‚‹å¿…è¦ãŒãªããªã‚Šã¾ã—ãŸã€‚"
echo ""
echo "ðŸ’¡ è¨­å®šã‚’å¤‰æ›´ã—ãŸã„å ´åˆ:"
echo "   python3 scripts/claude_auto_approver.py --help"
echo ""